FROM python:3.8
SHELL ["/bin/bash", "--login", "-c"]
RUN apt update && apt install -y tree && apt clean

# Copy all server code into workdir
WORKDIR /app
COPY ./pydatalab/ /app

# Install Pipenv and use it to grab dependencies
RUN pip install pipenv
RUN pipenv install --deploy --dev

# Run flask server
CMD ["pipenv", "run", "gunicorn", "-w", "2", "--error-logfile", "logs/pydatalab_error.log", "--access-logfile", "logs/pydatalab_access.log", "-b", "0.0.0.0:5001", "pydatalab.main:create_app()"]
